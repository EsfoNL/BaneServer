<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    {% include "header" %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
      body {
        background-color: black;
        color: green;
        font-family: mono;
      }

      #anchor {
        height: 2px;
      }
      
    </style>
    <script>
      addEventListener("DOMContentLoaded", (event) => {
        let onmsg = (m) => {
          let bottom = Math.ceil(window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1;;
          logs.innerText += m.data;
          if (bottom) {
            logs.scrollIntoView(false);
          }
        };
        let sleep = 1000;
        let ws = new WebSocket("/script/websocket/live-logs");
        ws.onmessage = onmsg;
        ws.onclose = () => {
          setTimeout(() => {
            ws = new WebSocket("/script/websocket/live-logs");
            ws.onmessage = onmsg;
            console.log("reconnect");
          }, 200)
        }
      });
    </script>
  </head>
  <body>
    <div id="logs">
      
    </div>
    <div id="anchor"></div>
  </body>
</html>
